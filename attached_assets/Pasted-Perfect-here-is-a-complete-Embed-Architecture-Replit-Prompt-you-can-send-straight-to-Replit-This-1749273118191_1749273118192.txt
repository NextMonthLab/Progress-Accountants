Perfect â€” here is a complete Embed Architecture Replit Prompt you can send straight to Replit.

This will:

âœ… Create an Embed Code Generator screen in the Admin Panel
âœ… Add the /embed.js endpoint â†’ serves the JS loader
âœ… Add basic Analytics API endpoints â†’ page views + event tracking
âœ… Wire it to your existing Admin Panel so businesses can generate their code â†’ paste it into any site â†’ see results in Admin

â¸»

REPLIT Prompt: Add Embed Architecture to Smart Site

You will now add the core Embed Architecture to the Smart Site.

Purpose:

âœ… Allow any business to copy a simple embed code and paste it into their existing website.
âœ… The embed script will:
    - Load the Smart Site AI Chat Assistant onto every page.
    - Track page views.
    - Track custom events (optional).
âœ… All data will flow back to the Smart Site backend and appear in the Admin Panel, scoped per tenant.

Part 1 â€” Backend

âœ… Add new API endpoint:

GET /embed.js

Behavior:

- Responds with JS (content-type: application/javascript)
- Script is parameterized via `?tenantId=XYZ`
- Example usage:

```html
<script src="https://smart.nextmonth.io/embed.js?tenantId=ABC123" async></script>

âœ… The embed.js script must:
	â€¢	Load an iframe or Shadow DOM-based Chat Assistant into the page (placeholder for now â€” can wire in later)
	â€¢	Send a POST to /api/analytics/page-view on page load with:

{
  tenantId: XYZ,
  pageUrl: current page URL,
  referrer: document.referrer,
  timestamp: current timestamp,
  sessionId: random session UUID (persisted per session)
}

âœ… Expose a JS API for event tracking:

window.NextMonthSmartSite.trackEvent('event_name', { customData });

POST /api/analytics/event â†’ payload:

{
  tenantId: XYZ,
  pageUrl: current page URL,
  eventName: "event_name",
  eventData: { ... },
  timestamp: current timestamp,
  sessionId: same session UUID
}

âœ… Log all analytics calls in AIEventLog:
	â€¢	eventType: â€œpage_viewâ€ or â€œcustom_eventâ€
	â€¢	Include all fields above.

Part 2 â€” Frontend (Admin Panel)

âœ… Add new screen: /admin/embed-code-generator

Sidebar label: Embed on Your Site

Screen content:
	â€¢	Short explanation:

"Paste this one line of code into your existing website.  
It will instantly enable your AI Chat Assistant and traffic tracking."

"You can install this on any CMS, site builder, or custom site.  
No backend integration required."

- Display unique embed snippet:

```html
<script src="https://smart.nextmonth.io/embed.js?tenantId=ABC123" async></script>

	â€¢	[Copy to Clipboard] button
	â€¢	Basic guidance on where to place the script (head or body).

âœ… Optional future feature (placeholder):
	â€¢	Toggle options:
	â€¢	Enable Chat Assistant? âœ…
	â€¢	Enable Page Tracking? âœ…
	â€¢	Enable Event Tracking? âœ…
	â€¢	(For now all defaults to ON)

Part 3 â€” Notes

âœ… The backend must validate that tenantId is valid and active before serving embed.js or accepting analytics POSTs.

âœ… This embed architecture must be fully functional even if the customer site is not hosted on Hetzner â†’ works universally.

âœ… The system must gracefully handle invalid tenantIds â†’ log error, return 404 or error script.

âœ… All tracked data must appear in Admin Panel (Analytics Dashboard) â†’ we can add full visual Analytics page in follow-up prompt.

âœ… The Chat Assistant can initially be a placeholder iframe to /chat-widget or similar â†’ will wire in fully later.

â¸»

Goal:

âœ… Each Smart Site Admin can generate a unique embed snippet.
âœ… They can paste it into their existing website.
âœ… Smart Site will then:
- Track page views.
- Track custom events.
- Display AI Chat Assistant.
âœ… Admin can log in and see all data.

â¸»

When complete, please confirm:

âœ… /embed.js endpoint is live and serving script correctly.
âœ… Admin Embed Code Generator screen is present and usable.
âœ… /api/analytics/page-view endpoint works and is logging.
âœ… /api/analytics/event endpoint works and is logging.

â¸»

Do not modify front-facing pages of customer sites â†’ all functionality must be opt-in and driven by explicit script inclusion via Embed Code Generator.

â¸»

Once this is complete, I can provide the next prompt to:

âœ… Build a full Analytics Dashboard in the Admin Panel:
- Traffic by page
- Traffic by referrer
- Event counts
- Chat volume per page

â¸»

Summary:
This is a core part of making Smart Sites valuable â†’ frictionless deployment â†’ works with any site â†’ sticky â†’ drives Smart Site value.

â¸»

Would you like me to also prepare the follow-up Analytics Dashboard Prompt now, so you have it ready once this is complete?
Just say Yes, Analytics Dashboard Prompt please ğŸš€. You are building an incredibly powerful system here!