
ğŸš€ MASTER UNIFIED ACCOUNT & BUSINESS ARCHITECTURE PROMPT

(Ready to copy-paste to Replit)

We are now defining the Master Business Identity Architecture for the entire NextMonth ecosystem.

This architecture is MANDATORY for ALL NextMonth apps:

âœ… NextMonth Home (marketing site + registration)  
âœ… NextMonth SmartSite (Admin Panel)  
âœ… NextGen Blog (public-facing content feed)  
âœ… Insight App (Insight submission app for employees)  
âœ… NextMonth Lab (Tool builder)  
âœ… NextMonth Dev (Advanced dev tools / APIs)  
âœ… SOT (Source of Truth â€” authoritative record of business state)

---

### CORE PRINCIPLE

âœ… The universal glue of the system is **businessId** â†’ also called tenantId.  
âœ… All data in the system MUST be linked to tenantId.

No app should create or store data without linking it to a valid tenantId.

---

### MASTER FLOW

#### 1ï¸âƒ£ Account Creation â†’ Business Registration

âœ… Happens on **NextMonth Home**:

- User enters email, password, businessName, industry, websiteURL â†’ proceeds to payment.
- On successful payment:

```json
{
  userId: UUID,
  businessId (tenantId): UUID,
  email: userEmail,
  role: "admin",
  paymentStatus: "active",
  plan: "smart_site_basic",
  createdAt
}

âœ… Business Profile MUST be written to SOT:

/businesses/tenantId/identity.json
{
  businessId: tenantId,
  businessName,
  industry,
  websiteURL,
  createdAt,
  adminUserId: userId,
  paymentStatus: "active",
  plan: "smart_site_basic"
}


â¸»

2ï¸âƒ£ Authentication (ALL Apps)

âœ… All authenticated apps issue JWT tokens with this payload:

{
  userId: UUID,
  tenantId: UUID,
  role: "admin" | "editor" | "insightUser" | "labUser" | "devUser",
  exp: timestamp
}

âœ… All API calls MUST carry this JWT â†’ backend must scope all actions to tenantId.

â¸»

3ï¸âƒ£ SOT Structure

All apps must write their data into the SOT, under this directory:

/businesses/tenantId/
    identity.json
    users/admin-userId.json
    insight-users/insightAppUserId.json
    insights/insightId.json
    blog-posts/postId.json
    themes/themeId.json
    innovation-ideas/ideaId.json
    analytics-events/eventId.json
    ai-event-log/eventId.json
    tools/toolId.json  â† Lab + Dev

âœ… No data should be written outside of this tenant-scoped structure.

âœ… This ensures clean multi-tenant behavior and safe scaling.

â¸»

4ï¸âƒ£ App Responsibilities

âœ… NextMonth Home:
	â€¢	Implements signup â†’ creates tenantId.
	â€¢	Seeds SOT business profile.

âœ… NextMonth SmartSite (Admin Panel):
	â€¢	All actions scoped to tenantId from JWT.
	â€¢	Admin can invite Insight App Users â†’ insightAppUserId linked to tenantId.
	â€¢	All content, Insights, AI Usage, Analytics must be written to SOT under tenantId.

âœ… NextGen Blog:
	â€¢	Public API MUST scope posts to /api/blog?tenantId=XYZ
	â€¢	Must read only posts tagged to correct tenantId.

âœ… Insight App:
	â€¢	Insight App Users submit Insights â†’ must include tenantId + insightAppUserId.
	â€¢	Insights written to /businesses/tenantId/insights/.

âœ… NextMonth Lab:
	â€¢	All Tools built must be linked to tenantId.
	â€¢	Tools stored in /businesses/tenantId/tools/.
	â€¢	Tools surfaced in SmartSite Admin Panel for that tenantId only.

âœ… NextMonth Dev:
	â€¢	Same as Lab â€” advanced tools, APIs must be linked to tenantId and stored accordingly.

âœ… SOT:
	â€¢	Authoritative source of truth for ALL apps.
	â€¢	No cross-tenant data leakage is allowed.
	â€¢	All apps must respect tenantId when reading/writing to SOT.

â¸»

5ï¸âƒ£ Business Identity Locking

âœ… Embed Code for Chat + Analytics:

<script src="https://smart.nextmonth.io/embed.js?tenantId=XYZ" async></script>

âœ… NextGen Blog â†’ scoped to tenantId.

âœ… Insight App â†’ submissions scoped to tenantId.

âœ… NextMonth Lab + Dev â†’ tools linked to tenantId â†’ visible only in SmartSite Admin Panel for that tenant.

â¸»

NON-NEGOTIABLE:

âœ… ALL apps must adopt this model.
âœ… No app may use its own notion of identity or store unlinked data.
âœ… This ensures system-wide data integrity and multi-tenant scaling.

â¸»

Final Notes:

âœ… All apps will soon receive individual prompts to implement THEIR participation in this architecture.
âœ… THIS PROMPT is to establish the shared SYSTEM CONTRACT across all apps first.

âœ… Please acknowledge receipt and understanding of this architecture.

â¸»

When you acknowledge this prompt, you must confirm:

âœ… â€œI understand that all data must be scoped to tenantId.â€
âœ… â€œI understand that all API calls must include tenantId via JWT.â€
âœ… â€œI understand that the SOT is the authoritative source of truth and must be written to correctly.â€
